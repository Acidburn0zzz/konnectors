{"version":3,"file":"public/javascripts/app.js","sources":["app/collections/konnectors.coffee","app/initialize.coffee","app/lib/base_view.coffee","app/lib/request.coffee","app/lib/view_collection.coffee","app/locales/en.coffee","app/locales/fr.coffee","app/models/konnector.coffee","app/realtime.coffee","app/router.coffee","app/views/app_view.coffee","app/views/konnector.coffee","app/views/menu.coffee","app/views/menu_item.coffee","app/views/templates/default.jade","app/views/templates/home.jade","app/views/templates/konnector.jade","app/views/templates/menu_item.jade"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhCA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAzCA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3CA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArCA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA3GA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxCA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxCA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA9BA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArCA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAhCA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AApFA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjKA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AArDA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAvDA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA1BA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AARA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAxCA;AAAA;CCAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA/BA;AAAA","sourcesContent":["var KonnectorsCollection,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = KonnectorsCollection = (function(_super) {\n  __extends(KonnectorsCollection, _super);\n\n  function KonnectorsCollection() {\n    return KonnectorsCollection.__super__.constructor.apply(this, arguments);\n  }\n\n  KonnectorsCollection.prototype.model = require('../models/konnector');\n\n  KonnectorsCollection.prototype.url = 'konnectors/';\n\n  KonnectorsCollection.prototype.comparator = function(a, b) {\n    if (a.isConfigured() && !b.isConfigured()) {\n      return -1;\n    } else if (!a.isConfigured() && b.isConfigured()) {\n      return 1;\n    } else if (a.get('name') > b.get('name')) {\n      return 1;\n    } else if (a.get('name') < b.get('name')) {\n      return -1;\n    } else {\n      return 0;\n    }\n  };\n\n  return KonnectorsCollection;\n\n})(Backbone.Collection);\n","var AppView, KonnectorListener, KonnectorsCollection, Router, request;\n\nrequest = require('./lib/request');\n\nKonnectorListener = require('./realtime');\n\nKonnectorsCollection = require('../collections/konnectors');\n\nAppView = require('./views/app_view');\n\nRouter = require('./router');\n\n$(function() {\n  var appView, e, initKonnectors, konnectors, locale, locales, polyglot, remoteChangeListener;\n  locale = window.locale;\n  polyglot = new Polyglot();\n  try {\n    locales = require(\"locales/\" + locale);\n  } catch (_error) {\n    e = _error;\n    locale = 'en';\n    locales = require('locales/en');\n  }\n  polyglot.extend(locales);\n  window.t = polyglot.t.bind(polyglot);\n  initKonnectors = window.initKonnectors || [];\n  konnectors = new KonnectorsCollection(initKonnectors);\n  remoteChangeListener = new KonnectorListener();\n  remoteChangeListener.watch(konnectors);\n  appView = new AppView({\n    collection: konnectors\n  });\n  appView.render();\n  window.router = new Router({\n    appView: appView\n  });\n  return request.get('folders', function(err, paths) {\n    appView.setFolders(paths);\n    return Backbone.history.start();\n  });\n});\n","var BaseView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = BaseView = (function(_super) {\n  __extends(BaseView, _super);\n\n  function BaseView() {\n    return BaseView.__super__.constructor.apply(this, arguments);\n  }\n\n  BaseView.prototype.template = function() {};\n\n  BaseView.prototype.initialize = function() {};\n\n  BaseView.prototype.getRenderData = function() {\n    var _ref;\n    return {\n      model: (_ref = this.model) != null ? _ref.toJSON() : void 0\n    };\n  };\n\n  BaseView.prototype.render = function() {\n    this.beforeRender();\n    this.$el.html(this.template(this.getRenderData()));\n    this.afterRender();\n    return this;\n  };\n\n  BaseView.prototype.beforeRender = function() {};\n\n  BaseView.prototype.afterRender = function() {};\n\n  BaseView.prototype.destroy = function() {\n    this.undelegateEvents();\n    this.$el.removeData().unbind();\n    this.remove();\n    return Backbone.View.prototype.remove.call(this);\n  };\n\n  return BaseView;\n\n})(Backbone.View);\n","exports.request = function(type, url, data, callback) {\n  return $.ajax({\n    type: type,\n    url: url,\n    data: data != null ? JSON.stringify(data) : null,\n    contentType: \"application/json\",\n    dataType: \"json\",\n    success: function(data) {\n      if (callback != null) {\n        return callback(null, data);\n      }\n    },\n    error: function(data) {\n      if ((data != null) && (data.msg != null) && (callback != null)) {\n        return callback(new Error(data.msg));\n      } else if (callback != null) {\n        return callback(new Error(\"Server error occured\"));\n      }\n    }\n  });\n};\n\nexports.get = function(url, callback) {\n  return exports.request(\"GET\", url, null, callback);\n};\n\nexports.post = function(url, data, callback) {\n  return exports.request(\"POST\", url, data, callback);\n};\n\nexports.put = function(url, data, callback) {\n  return exports.request(\"PUT\", url, data, callback);\n};\n\nexports.del = function(url, callback) {\n  return exports.request(\"DELETE\", url, null, callback);\n};\n","var BaseView, ViewCollection,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('lib/base_view');\n\nmodule.exports = ViewCollection = (function(_super) {\n  __extends(ViewCollection, _super);\n\n  function ViewCollection() {\n    this.fetch = __bind(this.fetch, this);\n    this.removeItem = __bind(this.removeItem, this);\n    this.addItem = __bind(this.addItem, this);\n    return ViewCollection.__super__.constructor.apply(this, arguments);\n  }\n\n  ViewCollection.prototype.itemview = null;\n\n  ViewCollection.prototype.views = {};\n\n  ViewCollection.prototype.template = function() {\n    return '';\n  };\n\n  ViewCollection.prototype.itemViewOptions = function() {};\n\n  ViewCollection.prototype.collectionEl = null;\n\n  ViewCollection.prototype.onChange = function() {\n    return this.$el.toggleClass('empty', _.size(this.views) === 0);\n  };\n\n  ViewCollection.prototype.appendView = function(view) {\n    return this.$collectionEl.append(view.el);\n  };\n\n  ViewCollection.prototype.initialize = function() {\n    ViewCollection.__super__.initialize.apply(this, arguments);\n    this.views = {};\n    this.listenTo(this.collection, 'reset', this.onReset);\n    this.listenTo(this.collection, 'add', this.addItem);\n    this.listenTo(this.collection, 'remove', this.removeItem);\n    this.listenTo(this.collection, 'sort', this.render);\n    return this.$collectionEl = $(this.collectionEl);\n  };\n\n  ViewCollection.prototype.render = function() {\n    var id, view, _ref;\n    _ref = this.views;\n    for (id in _ref) {\n      view = _ref[id];\n      view.$el.detach();\n    }\n    return ViewCollection.__super__.render.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.afterRender = function() {\n    var id, view, _ref;\n    _ref = this.views;\n    for (id in _ref) {\n      view = _ref[id];\n      this.appendView(view.$el);\n    }\n    this.onReset(this.collection);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.remove = function() {\n    this.onReset([]);\n    return ViewCollection.__super__.remove.apply(this, arguments);\n  };\n\n  ViewCollection.prototype.onReset = function(newcollection) {\n    var id, view, _ref;\n    _ref = this.views;\n    for (id in _ref) {\n      view = _ref[id];\n      view.remove();\n    }\n    return newcollection.forEach(this.addItem);\n  };\n\n  ViewCollection.prototype.addItem = function(model) {\n    var options, view;\n    options = _.extend({}, {\n      model: model\n    }, this.itemViewOptions(model));\n    view = new this.itemview(options);\n    this.views[model.cid] = view.render();\n    this.appendView(view);\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.removeItem = function(model) {\n    this.views[model.cid].remove();\n    delete this.views[model.cid];\n    return this.onChange(this.views);\n  };\n\n  ViewCollection.prototype.fetch = function(options) {\n    return this.collection.fetch(options);\n  };\n\n  return ViewCollection;\n\n})(BaseView);\n","module.exports = {\n  'bad credentials': 'Bad Credentials',\n  'no bills retrieved': 'No bills retrieved',\n  'key not found': 'Key not found',\n  'last import:': 'Last import:',\n  'import': 'Import',\n  'auto import': 'Automatic import',\n  'imported data:': 'Imported data:',\n  'importing...': 'importing...',\n  'no import performed': 'No import performed',\n  'firstname': 'Firstname',\n  'lastname': 'Lastname',\n  'login': 'Login',\n  'password': 'Password',\n  'email': 'Email',\n  'accessToken': 'Access token',\n  'accessTokenSecret': 'Access token secret',\n  'consumerKey': 'Consumer Key',\n  'consumerSecret': 'Consumer Secret',\n  'apikey': 'Api key',\n  'phoneNumber': 'Phone number',\n  'folderPath': 'Folder path',\n  'none': 'None',\n  'every hour': 'Every hour',\n  'every day': 'Every day',\n  'every week': 'Every week',\n  'each month': 'Each month',\n  'date format': 'LLL',\n  'home headline': \"With Konnectors you can retrieve many data and save them into your Cozy.\\nFrom your phone bills to your connected scale, or your tweets. Configure the connectors you are interested in:\",\n  'home config step 1': \"Select a connector in the menu on the left\",\n  'home config step 2': \"Follow the instructions to configure it\",\n  'home config step 3': \"Your data are retrieved and saved into your Cozy\",\n  'home more info': \"More information:\",\n  'home help step 1': \"You must manually trigger the import, except if you enable the auto-import.\",\n  'home help step 2': \"Disable the auto-stop feature for the Konnector application in your Cozy, otherwise the auto-import won't work.\",\n  'notification import success': 'Konnector %{name}: data have been successfully imported',\n  'notification import error': 'Konnector %{name}: an error occurred during import of data',\n  'error occurred during import.': 'An error occurred during the last import.',\n  'error occurred during import:': 'An error occurred during the last import:'\n};\n","module.exports = {\n  'bad credentials': 'Mauvais identifiants',\n  'no bills retrieved': 'Pas de facture trouvées',\n  'key not found': 'Clé non trouvée',\n  'last import:': 'Dernière importation :',\n  'import': 'Importer',\n  'auto import': 'Importation automatique',\n  'imported data:': 'Données importées :',\n  'importing...': 'importation en cours...',\n  'no import performed': \"Pas d'importation effectuée\",\n  'firstname': 'Prénom',\n  'lastname': 'Nom',\n  'login': 'Identifiant',\n  'password': 'Mot de passe',\n  'email': 'Mail',\n  'accessToken': 'Access token',\n  'accessTokenSecret': 'Access token secret',\n  'consumerKey': 'Consumer Key',\n  'consumerSecret': 'Consumer Secret',\n  'apikey': 'Api key',\n  'phoneNumber': 'Numéro de téléphone',\n  'folderPath': 'Chemin du dossier',\n  'none': 'Aucun',\n  'every hour': 'Toutes les heures',\n  'every day': 'Tous les jours',\n  'every week': 'Toutes les semaines',\n  'each month': 'Tous les mois',\n  'date format': 'DD/MM/YYYY [à] HH[h]mm',\n  'home headline': \"Konnectors vous permet de récupérer de nombreuses données et de les intégrer votre Cozy.\\nDe vos factures de téléphone aux données de votre balance connectée en passant par vos tweets. Configurez les connecteurs qui vous intéressent :\",\n  'home config step 1': \"Sélectionnez un connecteur dans le menu à gauche\",\n  'home config step 2': \"Suivez les instructions pour le configurer\",\n  'home config step 3': \"Vos données sont récupérées et intégrer à votre Cozy\",\n  'home more info': \"Quelques informations supplémentaires :\",\n  'home help step 1': \"Vous devez manuellement déclencher l'importation sauf si vous avez activé l'importation automatique\",\n  'home help step 2': \"Désactivez la fonction d'auto-stop pour l'application Konnectors dans votre Cozy, sinon l'importation automatique ne fonctionnera pas.\",\n  'notification import success': 'Konnector %{name}: les données ont été importées avec succès',\n  'notification import error': \"Konnector %{name}: une erreur est survenue pendant l'importation des données\",\n  'error occurred during import.': 'Une erreur est survenue lors de la dernière importation.',\n  'error occurred during import:': 'Une erreur est survenue lors de la dernière importation :'\n};\n","var KonnectorModel,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = KonnectorModel = (function(_super) {\n  __extends(KonnectorModel, _super);\n\n  function KonnectorModel() {\n    return KonnectorModel.__super__.constructor.apply(this, arguments);\n  }\n\n  KonnectorModel.prototype.rootUrl = \"konnectors/\";\n\n  KonnectorModel.prototype.isConfigured = function() {\n    var field, fieldValue, fieldValues, fields, noEmptyValue, numFieldValues, numFields, _ref;\n    fieldValues = this.get('fieldValues') || {};\n    fields = this.get('fields');\n    numFieldValues = Object.keys(fieldValues).length;\n    numFields = Object.keys(fields).length;\n    noEmptyValue = true;\n    for (field in fields) {\n      fieldValue = fields[field];\n      noEmptyValue = noEmptyValue && ((_ref = fieldValues[field]) != null ? _ref.length : void 0) > 0;\n    }\n    return numFieldValues >= numFields && noEmptyValue;\n  };\n\n  return KonnectorModel;\n\n})(Backbone.Model);\n","var Konnector, KonnectorListener,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nKonnector = require('../models/konnector');\n\nmodule.exports = KonnectorListener = (function(_super) {\n  __extends(KonnectorListener, _super);\n\n  function KonnectorListener() {\n    return KonnectorListener.__super__.constructor.apply(this, arguments);\n  }\n\n  KonnectorListener.prototype.models = {\n    konnector: Konnector\n  };\n\n  KonnectorListener.prototype.events = ['konnector.update'];\n\n  KonnectorListener.prototype.onRemoteUpdate = function(model) {\n    var formattedDate, isImporting, lastImport, slug;\n    isImporting = model.get('isImporting');\n    slug = model.get('slug');\n    lastImport = model.get('lastImport');\n    formattedDate = moment(lastImport).format(t('date format'));\n    if (isImporting) {\n      return $(\".konnector-\" + slug + \" .last-import\").html(t('importing...'));\n    } else if (lastImport != null) {\n      return $(\".konnector-\" + slug + \" .last-import\").html(formattedDate);\n    } else {\n      return $(\".konnector-\" + slug + \" .last-import\").html(t('no import performed'));\n    }\n  };\n\n  return KonnectorListener;\n\n})(CozySocketListener);\n","var Router,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nmodule.exports = Router = (function(_super) {\n  __extends(Router, _super);\n\n  function Router() {\n    return Router.__super__.constructor.apply(this, arguments);\n  }\n\n  Router.prototype.routes = {\n    '': 'main',\n    'konnector/:slug': 'konnector'\n  };\n\n  Router.prototype.initialize = function(options) {\n    Router.__super__.initialize.call(this);\n    return this.appView = options.appView;\n  };\n\n  Router.prototype.main = function() {\n    return this.appView.showDefault();\n  };\n\n  Router.prototype.konnector = function(slug) {\n    return this.appView.showKonnector(slug);\n  };\n\n  return Router;\n\n})(Backbone.Router);\n","var AppView, BaseView, KonnectorView, MenuView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nKonnectorView = require('./konnector');\n\nMenuView = require('./menu');\n\nmodule.exports = AppView = (function(_super) {\n  __extends(AppView, _super);\n\n  function AppView() {\n    return AppView.__super__.constructor.apply(this, arguments);\n  }\n\n  AppView.prototype.el = 'body';\n\n  AppView.prototype.template = require('./templates/home');\n\n  AppView.prototype.defaultTemplate = require('./templates/default');\n\n  AppView.prototype.events = {\n    'click #menu-toggler': 'toggleMenu'\n  };\n\n  AppView.prototype.afterRender = function() {\n    this.container = this.$('.container');\n    this.menuView = new MenuView({\n      collection: this.collection\n    });\n    return this.menuView.render();\n  };\n\n  AppView.prototype.showDefault = function() {\n    this.menuView.unselectAll();\n    this.container.html(this.defaultTemplate());\n    return this.hideMenu();\n  };\n\n  AppView.prototype.showKonnector = function(slug) {\n    var defaultView, el, konnector;\n    konnector = this.collection.findWhere({\n      slug: slug\n    });\n    if (this.konnectorView != null) {\n      this.konnectorView.destroy();\n    }\n    defaultView = this.container.find('#default');\n    if (defaultView.length > 0) {\n      this.$('#menu-toggler').remove();\n      defaultView.remove();\n    }\n    if (konnector != null) {\n      this.konnectorView = new KonnectorView({\n        model: konnector,\n        paths: this.paths\n      });\n      el = this.konnectorView.render().$el;\n      this.$('.container').append(el);\n      this.menuView.unselectAll();\n      this.menuView.selectItem(konnector.cid);\n      return this.hideMenu();\n    } else {\n      return window.router.navigate('', true);\n    }\n  };\n\n  AppView.prototype.setFolders = function(paths) {\n    return this.paths = paths;\n  };\n\n  AppView.prototype.toggleMenu = function() {\n    return this.$('#menu').toggleClass('active');\n  };\n\n  AppView.prototype.hideMenu = function() {\n    return this.$('#menu').removeClass('active');\n  };\n\n  return AppView;\n\n})(BaseView);\n","var BaseView, KonnectorView,\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = KonnectorView = (function(_super) {\n  __extends(KonnectorView, _super);\n\n  function KonnectorView() {\n    this.afterRender = __bind(this.afterRender, this);\n    return KonnectorView.__super__.constructor.apply(this, arguments);\n  }\n\n  KonnectorView.prototype.template = require('./templates/konnector');\n\n  KonnectorView.prototype.className = 'konnector';\n\n  KonnectorView.prototype.events = {\n    \"click #import-button\": \"onImportClicked\"\n  };\n\n  KonnectorView.prototype.initialize = function(options) {\n    KonnectorView.__super__.initialize.call(this, options);\n    this.paths = options.paths || [];\n    return this.listenTo(this.model, 'change', this.render);\n  };\n\n  KonnectorView.prototype.afterRender = function() {\n    var fieldHtml, formattedDate, importInterval, intervals, isImporting, key, lastAutoImport, lastImport, name, path, selected, slug, val, value, values, _i, _len, _ref, _ref1;\n    slug = this.model.get('slug');\n    lastImport = this.model.get('lastImport');\n    isImporting = this.model.get('isImporting');\n    lastAutoImport = this.model.get('lastAutoImport');\n    this.error = this.$('.error');\n    if ((this.model.get('errorMessage') == null) || isImporting) {\n      this.error.hide();\n    }\n    this.$el.addClass(\"konnector-\" + slug);\n    if (isImporting) {\n      this.$('.last-import').html(t('importing...'));\n    } else if (lastImport != null) {\n      formattedDate = moment(lastImport).format(t('date format'));\n      this.$('.last-import').html(formattedDate);\n    } else {\n      this.$('.last-import').html(t(\"no import performed\"));\n    }\n    values = this.model.get('fieldValues');\n    if (values == null) {\n      values = {};\n    }\n    _ref = this.model.get('fields');\n    for (name in _ref) {\n      val = _ref[name];\n      if (values[name] == null) {\n        values[name] = \"\";\n      }\n      fieldHtml = \"<div class=\\\"field line\\\">\\n<div><label for=\\\"\" + slug + \"-\" + name + \"-input\\\">\" + (t(name)) + \"</label></div>\";\n      if (val === 'folder') {\n        fieldHtml += \"<div><select id=\\\"\" + slug + \"-\" + name + \"-input\\\" class=\\\"folder\\\"\\n             value=\\\"\" + (t(values[name])) + \"\\\">\";\n        _ref1 = this.paths;\n        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {\n          path = _ref1[_i];\n          fieldHtml += \"<option value=\\\"\" + path + \"\\\">\" + path + \"</option>\";\n        }\n        fieldHtml += \"</select></div></div>\";\n      } else {\n        fieldHtml += \"<div><input id=\\\"\" + slug + \"-\" + name + \"-input\\\" type=\\\"\" + val + \"\\\"\\n            value=\\\"\" + values[name] + \"\\\"/></div>\\n</div>\";\n      }\n      this.$('.fields').append(fieldHtml);\n    }\n    importInterval = this.model.get('importInterval');\n    if (importInterval == null) {\n      importInterval = '';\n    }\n    intervals = {\n      none: t(\"none\"),\n      hour: t(\"every hour\"),\n      day: t(\"every day\"),\n      week: t(\"every week\"),\n      month: t(\"each month\")\n    };\n    fieldHtml = \"<div class=\\\"field line\\\">\\n<div><label for=\\\"\" + slug + \"-autoimport-input\\\">\" + (t('auto import')) + \"</label></div>\\n<div><select id=\\\"\" + slug + \"-autoimport-input\\\" class=\\\"autoimport\\\">\";\n    for (key in intervals) {\n      value = intervals[key];\n      selected = importInterval === key ? 'selected' : '';\n      fieldHtml += \"<option value=\\\"\" + key + \"\\\" \" + selected + \">\" + value + \"</option>\";\n    }\n    fieldHtml += \"\\n</select>\\n<span id=\\\"\" + slug + \"-first-import\\\">\\n<span id=\\\"\" + slug + \"-first-import-text\\\">\\n<a id=\\\"\" + slug + \"-first-import-link\\\" href=\\\"#\\\">Select a starting date</a></span>\\n<span id=\\\"\" + slug + \"-first-import-date\\\"><span>From</span>\\n<input id=\\\"\" + slug + \"-import-date\\\" class=\\\"autoimport\\\" maxlength=\\\"8\\\" type=\\\"text\\\"></input>\\n</span></span>\\n</div>\\n</div>\";\n    this.$('.fields').append(fieldHtml);\n    this.$(\"#\" + slug + \"-first-import-date\").hide();\n    this.$(\"#\" + slug + \"-import-date\").datepicker({\n      minDate: 1,\n      dateFormat: \"dd-mm-yy\"\n    });\n    if (this.$(\"#\" + slug + \"-autoimport-input\").val() !== 'none' && this.$(\"#\" + slug + \"-autoimport-input\").val() !== 'hour') {\n      if ((lastAutoImport != null) && moment(lastAutoImport).valueOf() > moment().valueOf()) {\n        this.$(\"#\" + slug + \"-first-import-date\").show();\n        this.$(\"#\" + slug + \"-first-import-text\").hide();\n        this.$(\"#\" + slug + \"-import-date\").val(moment(lastAutoImport).format('DD-MM-YYYY'));\n      } else {\n        this.$(\"#\" + slug + \"-first-import\").show();\n      }\n    } else {\n      this.$(\"#\" + slug + \"-first-import\").hide();\n    }\n    this.$(\"#\" + slug + \"-first-import-link\").click((function(_this) {\n      return function(event) {\n        event.preventDefault();\n        _this.$(\"#\" + slug + \"-first-import-date\").show();\n        return _this.$(\"#\" + slug + \"-first-import-text\").hide();\n      };\n    })(this));\n    return this.$(\"#\" + slug + \"-autoimport-input\").change((function(_this) {\n      return function() {\n        if (_this.$(\"#\" + slug + \"-autoimport-input\").val() !== 'none' && _this.$(\"#\" + slug + \"-autoimport-input\").val() !== 'hour') {\n          return _this.$(\"#\" + slug + \"-first-import\").show();\n        } else {\n          return _this.$(\"#\" + slug + \"-first-import\").hide();\n        }\n      };\n    })(this));\n  };\n\n  KonnectorView.prototype.onImportClicked = function() {\n    var data, fieldValues, importDate, importInterval, name, slug, val, _ref;\n    this.$('.error').hide();\n    fieldValues = {};\n    slug = this.model.get('slug');\n    importDate = $(\"#\" + slug + \"-import-date\").val();\n    fieldValues['date'] = importDate;\n    _ref = this.model.get('fields');\n    for (name in _ref) {\n      val = _ref[name];\n      fieldValues[name] = $(\"#\" + slug + \"-\" + name + \"-input\").val();\n    }\n    importInterval = 'none';\n    importInterval = $(\"#\" + slug + \"-autoimport-input\").val();\n    data = {\n      fieldValues: fieldValues,\n      importInterval: importInterval\n    };\n    return this.model.save(data, {\n      success: (function(_this) {\n        return function(model, success) {};\n      })(this),\n      error: (function(_this) {\n        return function(model, err) {\n          if (err.status !== 504) {\n            _this.$('.error .message').html(t(err.responseText));\n            return _this.$('.error').show();\n          }\n        };\n      })(this)\n    });\n  };\n\n  return KonnectorView;\n\n})(BaseView);\n","var KonnectorsView, MenuItemView, ViewCollection,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nViewCollection = require('../lib/view_collection');\n\nMenuItemView = require('./menu_item');\n\nmodule.exports = KonnectorsView = (function(_super) {\n  __extends(KonnectorsView, _super);\n\n  function KonnectorsView() {\n    return KonnectorsView.__super__.constructor.apply(this, arguments);\n  }\n\n  KonnectorsView.prototype.collectionEl = '#konnectors';\n\n  KonnectorsView.prototype.itemview = MenuItemView;\n\n  KonnectorsView.prototype.initialize = function(options) {\n    KonnectorsView.__super__.initialize.call(this, options);\n    this.listenTo(this.collection, 'change', this.collection.sort.bind(this.collection));\n    return this.listenTo(this.collection, 'change', this.render);\n  };\n\n  KonnectorsView.prototype.afterRender = function() {\n    KonnectorsView.__super__.afterRender.call(this);\n    return this.selectItem(this.selectedCid);\n  };\n\n  KonnectorsView.prototype.selectItem = function(modelCid) {\n    var view;\n    this.selectedCid = modelCid;\n    view = this.views[modelCid];\n    if (view != null) {\n      return view.select();\n    }\n  };\n\n  KonnectorsView.prototype.unselectAll = function() {\n    var index, view, _ref, _results;\n    _ref = this.views;\n    _results = [];\n    for (index in _ref) {\n      view = _ref[index];\n      _results.push(view.unselect());\n    }\n    return _results;\n  };\n\n  return KonnectorsView;\n\n})(ViewCollection);\n","var BaseView, MenuItemView,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nBaseView = require('../lib/base_view');\n\nmodule.exports = MenuItemView = (function(_super) {\n  __extends(MenuItemView, _super);\n\n  function MenuItemView() {\n    return MenuItemView.__super__.constructor.apply(this, arguments);\n  }\n\n  MenuItemView.prototype.tagName = 'li';\n\n  MenuItemView.prototype.template = require('./templates/menu_item');\n\n  MenuItemView.prototype.initialize = function(options) {\n    MenuItemView.__super__.initialize.call(this, options);\n    return this.listenTo(this.model, 'change', this.render);\n  };\n\n  MenuItemView.prototype.getRenderData = function() {\n    var formattedDate, lastImport;\n    lastImport = this.model.get('lastImport');\n    if (this.model.isConfigured() && (lastImport != null)) {\n      formattedDate = moment(lastImport).format(t('date format'));\n      lastImport = \"\" + (t('last import:')) + \"  \" + formattedDate;\n    } else if (this.model.isConfigured()) {\n      lastImport = t(\"no import performed\");\n    } else {\n      lastImport = \"\";\n    }\n    return _.extend({}, MenuItemView.__super__.getRenderData.call(this), {\n      lastImport: lastImport\n    });\n  };\n\n  MenuItemView.prototype.afterRender = function() {\n    if (this.model.isConfigured()) {\n      return this.$el.addClass('configured');\n    }\n  };\n\n  MenuItemView.prototype.select = function() {\n    return this.$el.addClass('selected');\n  };\n\n  MenuItemView.prototype.unselect = function() {\n    return this.$el.removeClass('selected');\n  };\n\n  return MenuItemView;\n\n})(BaseView);\n","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div id=\"menu-toggler\"><div class=\"fa fa-bars\"></div></div><div id=\"default\">');\nvar __val__ = t('home headline')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<ul><li>');\nvar __val__ = t('home config step 1')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</li><li>');\nvar __val__ = t('home config step 2')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</li><li>');\nvar __val__ = t('home config step 3')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</li></ul>' + escape((interp = t('home more info')) == null ? '' : interp) + '<ul><li>');\nvar __val__ = t('home help step 1')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</li><li>');\nvar __val__ = t('home help step 2')\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</li></ul></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<div id=\"menu\"><h1><a href=\"#\">Konnectors</a></h1><ul id=\"konnectors\"></ul></div><div class=\"container\"></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<!-- .konnector --><h2 class=\"name\"><div id=\"menu-toggler\"><div class=\"fa fa-bars\"></div></div><span>' + escape((interp = model.name) == null ? '' : interp) + '</span></h2><div class=\"description\">' + escape((interp = model.description) == null ? '' : interp) + '</div><div class=\"fields\"></div><div class=\"buttons\"><button id=\"import-button\">' + escape((interp = t('import')) == null ? '' : interp) + '</button></div><div class=\"error\"><span class=\"error\">');\nvar __val__ = t('error occurred during import:') + ' '\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('<span class=\"message\">');\nvar __val__ = t(model.errorMessage)\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span></span></div><div class=\"status\">' + escape((interp = status) == null ? '' : interp) + '</div><div class=\"infos\"><div class=\"date\"><span class=\"label\">' + escape((interp = t('last import:')) == null ? '' : interp) + '&nbsp;</span><span class=\"last-import\"></span></div><div class=\"datas\">' + escape((interp = t('imported data:')) == null ? '' : interp) + '&nbsp;');\n// iterate model.modelNames\n;(function(){\n  if ('number' == typeof model.modelNames.length) {\n\n    for (var $index = 0, $$l = model.modelNames.length; $index < $$l; $index++) {\n      var name = model.modelNames[$index];\n\nbuf.push('<a');\nbuf.push(attrs({ 'href':(\"/apps/databrowser/#search/all/\" + (name) + \"\"), 'target':(\"_blank\") }, {\"href\":true,\"target\":true}));\nbuf.push('>' + escape((interp = name) == null ? '' : interp) + '</a>&nbsp;');\n    }\n\n  } else {\n    var $$l = 0;\n    for (var $index in model.modelNames) {\n      $$l++;      var name = model.modelNames[$index];\n\nbuf.push('<a');\nbuf.push(attrs({ 'href':(\"/apps/databrowser/#search/all/\" + (name) + \"\"), 'target':(\"_blank\") }, {\"href\":true,\"target\":true}));\nbuf.push('>' + escape((interp = name) == null ? '' : interp) + '</a>&nbsp;');\n    }\n\n  }\n}).call(this);\n\nbuf.push('</div></div>');\n}\nreturn buf.join(\"\");\n};","module.exports = function anonymous(locals, attrs, escape, rethrow, merge) {\nattrs = attrs || jade.attrs; escape = escape || jade.escape; rethrow = rethrow || jade.rethrow; merge = merge || jade.merge;\nvar buf = [];\nwith (locals || {}) {\nvar interp;\nbuf.push('<a');\nbuf.push(attrs({ 'href':(\"#konnector/\" + (model.slug) + \"\") }, {\"href\":true}));\nbuf.push('><span class=\"name\">');\nvar __val__ = model.name\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span>');\n if(lastImport != null && lastImport.length > 0)\n{\nbuf.push('<span class=\"last-import\">');\nvar __val__ = lastImport\nbuf.push(escape(null == __val__ ? \"\" : __val__));\nbuf.push('</span>');\n}\n if (model.isImporting === true)\n{\nbuf.push('<div class=\"spinholder\"><img src=\"images/spinner.svg\"/></div>');\n}\n else if (model.errorMessage != null)\n{\nbuf.push('<i');\nbuf.push(attrs({ 'title':(t('error occurred during import.')), \"class\": ('fa') + ' ' + ('fa-warning') }, {\"title\":true}));\nbuf.push('></i>');\n}\nbuf.push('</a>');\n}\nreturn buf.join(\"\");\n};"]}